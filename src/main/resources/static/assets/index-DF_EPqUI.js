var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,i=(e,a,l)=>new Promise(((t,s)=>{var r=e=>{try{i(l.next(e))}catch(a){s(a)}},o=e=>{try{i(l.throw(e))}catch(a){s(a)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,o);i((l=l.apply(e,a)).next())}));import{o as u,b as c,i as n,p as d,m as p,f as m,n as v,E as f,_ as y}from"./index-fx4psQIV.js";/* empty css                  *//* empty css                    */import{_ as h}from"./ArtWangEditor.vue_vue_type_style_index_0_lang-B2RBoEK_.js";/* empty css               *//* empty css               */import{k as _,al as g,l as b,c as j,r as w,e as V,m as x,t as A,z as k,x as P,y as $,aJ as E,L as O,i as T,u as q,ad as D,I,J as M,S as U,ae as Y,aL as z,a4 as L,aR as N,H as S,aS as J,ab as W,a3 as B,T as C,G,P as H,E as R}from"./vendor-CRv0DxJL.js";import{P as F}from"./formEnum-BLgiZVxV.js";class K{static getArticleList(e){const{page:a,size:l,searchVal:t,year:s}=e;return u.get({url:`/api/articles/${a}/${l}?title=${t}&year=${s}`})}static getArticleTypes(e){return u.get({url:"/api/articles/types",params:e})}static getArticleDetail(e){return u.get({url:`/api/articles/${e}`})}static addArticle(e){return u.post({url:"/api/articles/",data:e})}static editArticle(e,a){return u.put({url:`/api/articles/${e}`,data:a})}}const Q={class:"article-edit"},X={class:"editor-wrap"},Z={class:"form-wrap"},ee={class:"el-top upload-container"},ae={key:0,class:"upload-placeholder"},le=["src"],te={style:{display:"flex","justify-content":"flex-end"}},se=_((re=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&o(e,l,a[l]);if(t)for(var l of t(a))r.call(a,l)&&o(e,l,a[l]);return e})({},{name:"ArticlePublish"}),a(re,l({__name:"index",setup(e){const a=g(),l=b(),t=c();let{saTokenInfo:s}=t;const r=j((()=>({[s.tokenName]:s.tokenValue})));let o=F.Add;const u=w(""),y=w(),_=w(),se=w(""),re=w(""),oe=w(""),ie=w(!0);V((()=>{n().scrollToTop(),de(),ue()}));const ue=()=>{const{id:e}=a.query;o=e?F.Edit:F.Add,o===F.Edit&&e?ce(Number(e)):ne()},ce=e=>{pe=e,me()},ne=()=>{re.value=fe(d().value)},de=()=>i(this,null,(function*(){try{const e=yield p.get("https://www.qiniu.lingchen.kim/classify.json");200===e.data.code&&(_.value=e.data.data)}catch(e){}}));let pe=0;const me=()=>i(this,null,(function*(){const e=yield p.get("https://www.qiniu.lingchen.kim/blog_list.json");if(e.data.code===m.success){let{title:a,blog_class:l,html_content:t}=e.data.data;u.value=a,y.value=Number(l),se.value=t}})),ve=()=>{o===F.Edit?ge():_e()},fe=e=>v(e,"YYYY-MM-DD").value,ye=()=>u.value?y.value?"<p><br></p>"===se.value?(R.error("请输入文章内容"),!1):!!oe.value||(R.error("请上传图片"),!1):(R.error("请选择文章类型"),!1):(R.error("请输入文章标题"),!1),he=()=>({title:u.value,html_content:se.value,home_img:oe.value,blog_class:y.value,create_time:re.value}),_e=()=>i(this,null,(function*(){try{if(!ye())return;se.value=be(se.value);const e=he();(yield K.addArticle(e)).code===m.success&&(R.success(`发布成功 ${f[200]}`),Ve())}catch(e){}})),ge=()=>i(this,null,(function*(){try{if(!ye())return;se.value=be(se.value);const e=he();(yield K.editArticle(pe,e)).code===m.success&&(R.success(`修改成功 ${f[200]}`),Ve())}catch(e){}})),be=e=>e.replace(/(\s*)<\/code>/g,"</code>"),je=e=>{oe.value=e.data.url,R.success(`图片上传成功 ${f[200]}`)},we=()=>{R.error(`图片上传失败 ${f[500]}`)},Ve=()=>{setTimeout((()=>{l.go(-1)}),800)},xe=e=>{const a=e.type.startsWith("image/"),l=e.size/1024/1024<2;return a?!!l||(R.error("图片大小不能超过 2MB!"),!1):(R.error("只能上传图片文件!"),!1)};return(e,a)=>{const l=O,t=E,s=Y,i=D,c=z,n=h,d=S,p=N,m=L,v=W,f=B,g=H;return A(),x("div",Q,[k("div",null,[k("div",X,[P(c,{gutter:10},{default:$((()=>[P(t,{span:18},{default:$((()=>[P(l,{modelValue:q(u),"onUpdate:modelValue":a[0]||(a[0]=e=>T(u)?u.value=e:null),modelModifiers:{trim:!0},placeholder:"请输入文章标题（最多100个字符）",maxlength:"100"},null,8,["modelValue"])])),_:1}),P(t,{span:6},{default:$((()=>[P(i,{modelValue:q(y),"onUpdate:modelValue":a[1]||(a[1]=e=>T(y)?y.value=e:null),placeholder:"请选择文章类型",filterable:""},{default:$((()=>[(A(!0),x(I,null,M(q(_),(e=>(A(),U(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),P(n,{class:"el-top",modelValue:q(se),"onUpdate:modelValue":a[2]||(a[2]=e=>T(se)?se.value=e:null)},null,8,["modelValue"]),k("div",Z,[a[6]||(a[6]=k("h2",null,"发布设置",-1)),P(f,null,{default:$((()=>[P(m,{label:"封面"},{default:$((()=>[k("div",ee,[P(p,{class:"cover-uploader",action:"/api/iboot/api/common/upload",headers:q(r),"show-file-list":!1,"on-success":je,"on-error":we,"before-upload":xe},{default:$((()=>[q(oe)?(A(),x("img",{key:1,src:q(oe),class:"cover-image"},null,8,le)):(A(),x("div",ae,[P(d,{class:"upload-icon"},{default:$((()=>[P(q(J))])),_:1}),a[4]||(a[4]=k("div",{class:"upload-text"},"点击上传封面",-1))]))])),_:1},8,["headers"]),a[5]||(a[5]=k("div",{class:"el-upload__tip"},"建议尺寸 16:9，jpg/png 格式",-1))])])),_:1}),P(m,{label:"可见"},{default:$((()=>[P(v,{modelValue:q(ie),"onUpdate:modelValue":a[3]||(a[3]=e=>T(ie)?ie.value=e:null)},null,8,["modelValue"])])),_:1})])),_:1}),k("div",te,[P(g,{type:"primary",onClick:ve,style:{width:"100px"}},{default:$((()=>[C(G(q(o)===q(F).Edit?"保存":"发布"),1)])),_:1})])])])])])}}}))));var re;const oe=y(se,[["__scopeId","data-v-06765bac"]]);export{oe as default};
