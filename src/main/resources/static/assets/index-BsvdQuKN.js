import{_ as t}from"./index-ud5QEMuE.js";import{c as o,d as e,X as i,f as l,a6 as s,P as a,J as r,a3 as h,e as n,a$ as d,k as g,j as m,K as x,a7 as c,h as w,r as u,l as p,o as B,w as f,I as y,u as I,aa as v,i as b,L as C,v as M}from"./vendor-CbDhNKi9.js";import{l as T}from"./lock_screen_1-ChV73K_E.js";const k="3.0.5",O={name:"ImgCutter",props:{crossOrigin:{type:Boolean,default:!1,required:!1},crossOriginHeader:{type:String,default:"*",required:!1},label:{type:String,default:"选择图片",required:!1},isModal:{type:Boolean,default:!0,required:!1},lockScroll:{type:Boolean,default:!0,required:!1},showChooseBtn:{type:Boolean,default:!0,required:!1},boxWidth:{type:Number,default:800,required:!1},boxHeight:{type:Number,default:400,required:!1},cutWidth:{type:Number,default:200,required:!1},cutHeight:{type:Number,default:200,required:!1},rate:{type:String,default:null,required:!1},tool:{type:Boolean,default:!0,required:!1},toolBgc:{type:String,default:"#fff",required:!1},imgMove:{type:Boolean,default:!0,required:!1},sizeChange:{type:Boolean,default:!0,required:!1},originalGraph:{type:Boolean,default:!1,required:!1},moveAble:{type:Boolean,default:!0,required:!1},previewMode:{type:Boolean,default:!0,required:!1},CuttingOriginal:{type:Boolean,default:!1,required:!1},WatermarkText:{type:String,default:"",required:!1},WatermarkTextFont:{type:String,default:"12px Sans-serif",required:!1},WatermarkTextColor:{type:String,default:"#fff",required:!1},WatermarkTextX:{type:Number,default:.95,required:!1},WatermarkTextY:{type:Number,default:.95,required:!1},smallToUpload:{type:Boolean,default:!1,required:!1},saveCutPosition:{type:Boolean,default:!1,required:!1},scaleAble:{type:Boolean,default:!0,required:!1},index:{default:null,required:!1},fileType:{default:"png",required:!1,type:String},toolBoxOverflow:{type:Boolean,default:!0,required:!1},DoNotDisplayCopyright:{type:Boolean,default:!1,required:!1},quality:{type:Number,default:1,required:!1},accept:{type:String,default:"image/gif, image/jpeg ,image/png",required:!1}},model:["label","boxWidth","boxHeight","rate","tool","DoNotDisplayCopyright"],data(){let t,o;return t=this.boxWidth/2,o=this.boxHeight/2,{version:"",visible:!1,fileName:"",cutImageObj:null,onPrintImgTimmer:null,toolBoxPosition:{x:0,y:0},drawImg:{img:null,sx:0,sy:0,swidth:0,sheight:0,x:0,y:0,width:0,height:0},toolBox:{disable:!0,width:t,height:o,x:0,y:0,boxMove:{start:{x:0,y:0},moveTo:{x:0,y:0}}},dropImg:{active:!1,pageX:0,pageY:0,params:{}},rotateImg:{angle:0},rotateControl:{active:!1,start:{x:0,y:0},position:100},scaleImg:{rate:0,params:{}},controlBox:{disable:!0,btnName:"",start:{x:0,y:0,width:0,height:0}},selectBox:!1,selectBoxColor:"rgba(0,0,0,0.6)",isFlipHorizontal:!1,isFlipVertically:!1}},mounted(){this.version=k,!1===this.isModal&&(this.visible=!0,this.$nextTick((()=>{this.$refs.toolBox&&(this.$refs.toolBox.onmousewheel=this.scaleImgWheel,this.$refs.toolBox.addEventListener("DOMMouseScroll",this.scaleImgWheel))})))},methods:{handleOpen(t){let o=t=>{if(this.$refs.toolBox&&(this.$refs.toolBox.onmousewheel=this.scaleImgWheel,this.$refs.toolBox.addEventListener("DOMMouseScroll",this.scaleImgWheel)),!0===this.isModal){!0===this.lockScroll&&(document.body.style.overflowY="hidden");let t=this.$refs.dialogMainModalRef.offsetHeight+200,o=window.innerHeight,e=this.$refs.mask;e.style.overflowY=t>o?"scroll":"hidden"}t&&"function"==typeof t&&t()};if(t&&"object"==typeof t&&t.src){if(!t.name)throw new Error("传入参数必须包含：src,name");{let e=new Image;!0===this.crossOrigin&&(e.crossOrigin=this.crossOriginHeader),e.name=t.name,e.style.position="fixed",e.style.top="-5000px",e.style.opacity=0,e.onerror=t=>{this.$emit("error",{index:this.index,event:t,msg:"图片加载失败"}),this.clearCutImageObj()},e.onerror=t=>{throw this.$emit("onImageLoadError",t),new Error("图片加载失败")},e.onload=()=>{if(!0!==e.complete)throw new Error("图片加载失败");this.$emit("onImageLoadComplete",e),this.visible=!0,this.$nextTick((()=>{o((()=>{this.importImgToCanv(e)}))}))},e.src=t.src,this.cutImageObj=e,document.body.appendChild(e),this.$emit("onChooseImg",t,this.index)}}else this.visible=!0,this.$nextTick((()=>{o()}))},handleClose(){this.clearAll(),!0===this.isModal&&(!0===this.lockScroll&&(document.body.style.overflowY="scroll"),this.$nextTick((()=>{this.visible=!1})))},chooseImg(){this.$refs.inputFile.click()},importImgToCanv(t){let o,e=t.height,i=t.width,l=this.boxWidth,s=this.boxHeight,a={...this.drawImg};this.fileName=t.name,a.img=t,this.scaleImg.rate=i/e,e<s&&i<l?(o=1,a.x=(l-i)/2,a.y=(s-e)/2):i/e<=l/s?(o=s/e,a.x=(l-i*o)/2):(o=l/i,a.y=(s-e*o)/2),a.swidth=i,a.sheight=e,a.width=i*o,a.height=e*o,a.x=(l-a.width)/2,a.y=(s-a.height)/2,this.drawImg=a,this.printImg(),this.putToolBox()},putImgToCanv(t){let o;if(!t.target.files)return!1;if(o=t.target.files[0]||null,o){this.fileName=o.name;let t=new FileReader;t.readAsDataURL(o),t.onload=e=>{let i=e.target.result,l=document.createElement("img");l.src=i;let s=setInterval((()=>{if(2===t.readyState){if(clearInterval(s),!this.sizeChange&&this.smallToUpload&&l.width<=this.cutWidth&&l.height<=this.cutHeight)return this.handleClose(),o.name=this.changeFileName(o.name,this.fileType),void this.$emit("cutDown",{filename:this.changeFileName(o.name,this.fileType),file:o,index:this.index});let t,e=l.height,i=l.width,a=this.boxWidth,r=this.boxHeight,h={...this.drawImg};h.img=l,this.scaleImg.rate=i/e,e<r&&i<a?(t=1,h.x=(a-i)/2,h.y=(r-e)/2):i/e<=a/r?(t=r/e,h.x=(a-i*t)/2):(t=a/i,h.y=(r-e*t)/2),h.swidth=i,h.sheight=e,h.width=i*t,h.height=e*t,h.x=(a-h.width)/2,h.y=(r-h.height)/2,this.drawImg=h,this.printImg(),this.putToolBox()}}),200)},this.$emit("onChooseImg",o,this.index)}},putToolBox(){this.toolBox.width!==this.boxWidth/2&&this.toolBox.height!==this.boxHeight/2&&!1!==this.saveCutPosition||(this.toolBox.width=this.cutWidth>this.boxWidth?this.boxWidth:this.cutWidth,this.toolBox.height=this.cutHeight>this.boxHeight?this.boxHeight:this.cutHeight),(0===this.toolBox.x&&0===this.toolBox.y||!1===this.saveCutPosition)&&(this.toolBox.x=this.boxWidth/2-this.toolBox.width/2,this.toolBox.y=this.boxHeight/2-this.toolBox.height/2),this.checkToolBoxOverflow().then((()=>{this.printImg()})),this.drawControlBox(this.toolBox.width,this.toolBox.height,this.toolBox.x,this.toolBox.y)},checkToolBoxOverflow(){return new Promise((t=>{if(!this.toolBoxOverflow){if(this.drawImg.width<this.toolBox.width||this.drawImg.height<this.toolBox.height){const t=this.drawImg.width/this.drawImg.height;this.drawImg.width<this.toolBox.width&&(this.drawImg.width=this.toolBox.width,this.drawImg.height=this.drawImg.width/t),this.drawImg.height<this.toolBox.height&&(this.drawImg.height=this.toolBox.height,this.drawImg.width=this.drawImg.height*t),this.drawImg.x=(this.boxWidth-this.drawImg.width)/2,this.drawImg.y=(this.boxHeight-this.drawImg.height)/2}this.drawImg.x>this.toolBox.x&&(this.drawImg.x=this.toolBox.x),this.drawImg.x+this.drawImg.width<this.toolBox.x+this.toolBox.width&&(this.drawImg.x=this.toolBox.x+this.toolBox.width-this.drawImg.width),this.drawImg.y>this.toolBox.y&&(this.drawImg.y=this.toolBox.y),this.drawImg.y+this.drawImg.height<this.toolBox.y+this.toolBox.height&&(this.drawImg.y=this.toolBox.y+this.toolBox.height-this.drawImg.height)}t()}))},isSupportFileApi:()=>!!(window.File&&window.FileList&&window.FileReader&&window.Blob&&-1===navigator.userAgent.indexOf("Edge")&&-1===navigator.userAgent.indexOf("MSIE")&&-1===navigator.userAgent.indexOf("Trident")),dataURLtoFile(t,o){let e=t.split(","),i=e[0].match(/:(.*?);/)[1],l=atob(e[1]),s=l.length,a=new Uint8Array(s);for(;s--;)a[s]=l.charCodeAt(s);if(this.isSupportFileApi()){return new File([a],o,{type:i})}return"不支持File对象"},clearAll(){let t=this,o=t.$refs.canvas;o.getContext("2d").clearRect(0,0,o.width,o.height);let e=t.$refs.canvasSelectBox;e.getContext("2d").clearRect(0,0,e.width,e.height);let i=t.drawImg.sx,l=t.drawImg.sy;this.drawImg={img:null,sx:i,sy:l,swidth:0,sheight:0,x:0,y:0,width:0,height:0},this.isFlipHorizontal=!1,this.isFlipVertically=!1,this.$refs.inputFile.value="",this.rotateImg.angle=0,this.drawImg.img=null,this.turnReset(),this.clearCutImageObj(),this.$emit("onClearAll",this.index)},clearCutImageObj(){null!==this.cutImageObj&&void 0!==this.cutImageObj&&("function"==typeof this.cutImageObj.remove?this.cutImageObj.remove():this.cutImageObj.removeNode()),this.cutImageObj=null},drawControlBox(t,o,e,i){this.toolBoxOverflow||(t<1&&(t=1),o<1&&(o=1),t>this.drawImg.width&&(t=this.drawImg.width),o>this.drawImg.height&&(o=this.drawImg.height),e<this.drawImg.x&&(e=this.drawImg.x),i<this.drawImg.y&&(i=this.drawImg.y),e>this.drawImg.x+this.drawImg.width-t&&(e=this.drawImg.x+this.drawImg.width-t),i>this.drawImg.y+this.drawImg.height-o&&(i=this.drawImg.y+this.drawImg.height-o)),t>this.boxWidth&&(t=this.boxWidth),o>this.boxHeight&&(o=this.boxHeight),e<0&&(e=0),i<0&&(i=0);let l,s,a=this.$refs.toolBoxControl,r=this.$refs.canvasSelectBox,h=r.getContext("2d");if(h.fillStyle=this.selectBoxColor,h.clearRect(0,0,r.width,r.height),h.fillRect(0,0,r.width,r.height),this.rate&&""!==this.rate){let e=this.rate.split(":")[0]/this.rate.split(":")[1];e>=1?(l=t,s=t/e,s+i>this.drawImg.y+this.drawImg.height&&(s=this.drawImg.y+this.drawImg.height-i,l=s*e)):(l=o*e,s=o)}else l=t,s=o;this.toolBox.width=Math.abs(l),this.toolBox.height=Math.abs(s),a.style.width=Math.abs(l)+"px",a.style.height=Math.abs(s)+"px",this.toolBox.boxMove.moveTo.x=e,this.toolBox.boxMove.moveTo.y=i,l<0&&(e+=l),s<0&&(i+=s),e+this.toolBox.width>this.boxWidth&&(e=this.boxWidth-this.toolBox.width),e<0&&(e=0),i+this.toolBox.height>this.boxHeight&&(i=this.boxHeight-this.toolBox.height),i<0&&(i=0),this.toolBoxPosition.x=e,this.toolBoxPosition.y=i,a.style.left=e+"px",a.style.top=i+"px",h.clearRect(e,i,Math.abs(l),Math.abs(s)),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100)},resetToolBox(){this.toolBox.width<0&&(this.toolBox.boxMove.moveTo.x=this.toolBox.x-this.toolBox.width),this.toolBox.height<0&&(this.toolBox.boxMove.moveTo.y=this.toolBox.y-this.toolBox.height),this.toolBox.width=Math.abs(this.toolBox.width),this.toolBox.height=Math.abs(this.toolBox.height)},toolBoxMouseDown(t){let o=this.$refs.toolBoxControl;this.toolBox.x=parseInt(o.style.left.split("px")[0]),this.toolBox.y=parseInt(o.style.top.split("px")[0]),this.toolBox.disable=!1,this.dropImg.active=!1,this.toolBox.boxMove.start={x:t.pageX,y:t.pageY}},toolBoxMouseMove(t){if(this.dropImg.active&&this.dropImgMove(t),!1===this.toolBox.disable&&!0===this.moveAble){let o=t.pageX-this.toolBox.boxMove.start.x,e=t.pageY-this.toolBox.boxMove.start.y,i=this.toolBox.x+o,l=this.toolBox.y+e;this.drawControlBox(this.toolBox.width,this.toolBox.height,i,l)}},toolBoxMouseLeave(){this.toolBox.disable=!0,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100),this.resetToolBox()},toolBoxMouseUp(){this.toolBox.x=parseInt(this.toolBoxPosition.x),this.toolBox.y=parseInt(this.toolBoxPosition.y),this.toolBox.disable=!0,this.dropImg.active=!1,this.resetToolBox()},printImg(){if(this.drawImg.img){let t=this.$refs.canvas,o=t.getContext("2d");o.font="18px bold 黑体",o.fillStyle="#ff0",o.textAlign="center",o.textBaseline="middle",o.save(),o.clearRect(0,0,t.width,t.height),o.translate(this.drawImg.x+this.drawImg.width/2,this.drawImg.y+this.drawImg.height/2),o.rotate(this.rotateImg.angle*Math.PI/180),o.translate(-(this.drawImg.x+this.drawImg.width/2),-(this.drawImg.y+this.drawImg.height/2)),o.translate(this.drawImg.x,this.drawImg.y),o.scale(this.isFlipHorizontal?-1:1,this.isFlipVertically?-1:1),o.drawImage(this.drawImg.img,this.drawImg.sx,this.drawImg.sy,this.drawImg.swidth,this.drawImg.sheight,this.isFlipHorizontal?-this.drawImg.width:0,this.isFlipVertically?-this.drawImg.height:0,this.drawImg.width,this.drawImg.height),o.translate(-this.drawImg.x,this.drawImg.y),o.restore(),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100)}},dropImgOn(t){!0===this.imgMove&&(this.dropImg.active=!0,this.dropImg.params={...this.drawImg},this.dropImg.pageX=t.pageX,this.dropImg.pageY=t.pageY)},dropImgOff(){this.dropImg.active=!1,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100)},dropImgMove(t){if(this.dropImg.active&&this.drawImg.img){let o={...this.drawImg};o.x=this.dropImg.params.x-(this.dropImg.pageX-t.pageX),o.y=this.dropImg.params.y-(this.dropImg.pageY-t.pageY),this.toolBoxOverflow||(o.x>this.toolBox.x&&(o.x=this.toolBox.x),o.x<this.toolBox.x+this.toolBox.width-o.width&&(o.x=this.toolBox.x+this.toolBox.width-o.width),o.y>this.toolBox.y&&(o.y=this.toolBox.y),o.y<this.toolBox.y+this.toolBox.height-o.height&&(o.y=this.toolBox.y+this.toolBox.height-o.height)),this.drawImg=o,this.printImg(),t.stopPropagation()}},scaleReset(){this.drawImg.width=this.drawImg.swidth,this.drawImg.height=this.drawImg.sheight,this.printImg()},scaleImgWheel(t){if(this.drawImg.img&&!0===this.scaleAble){let o,e=t||window.event;e.wheelDelta?o=-e.wheelDelta/40:e.detail&&(o=e.detail);let i=50;this.drawImg.x=this.drawImg.width-9*o>i?this.drawImg.x+3*o:this.drawImg.x,this.drawImg.y=this.drawImg.width-9*o>i?this.drawImg.y+3*o:this.drawImg.y,this.drawImg.width=this.drawImg.width-9*o>i?this.drawImg.width-9*o:i,this.drawImg.height=this.drawImg.width/this.scaleImg.rate,this.checkToolBoxOverflow().then((()=>{this.printImg(),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout((()=>{this.cropPicture(!0)}),100)}))}return t.preventDefault(),t.returnValue=!1,!1},flipHorizontal(){this.drawImg.img&&(0==this.isFlipHorizontal?this.isFlipHorizontal=!0:this.isFlipHorizontal=!1,this.printImg())},flipVertically(){this.drawImg.img&&(0==this.isFlipVertically?this.isFlipVertically=!0:this.isFlipVertically=!1,this.printImg())},turnImg(t){let o=this.rotateImg.angle+t;o>=-180&&o<=180&&(this.rotateImg.angle=o,this.rotateControl.position=o/180*100+100,this.printImg("rotate"))},turnReset(){this.rotateImg.angle=0,this.rotateControl.position=100,this.printImg("rotate")},controlBtnMouseDown(t,o){this.controlBox.disable=!1,this.controlBox.btnName=o,this.controlBox.start.x=t.clientX,this.controlBox.start.y=t.clientY,this.controlBox.start.width=this.toolBox.width,this.controlBox.start.height=this.toolBox.height,t.stopPropagation()},controlBtnMouseUp(t){this.controlBox.disable=!0,this.dropImgOff(),this.resetToolBox(),this.toolBoxMouseUp(),t.stopPropagation()},controlBtnMouseMove(t){if(!1===this.controlBox.disable){let o,e,i=t.clientX-this.controlBox.start.x,l=t.clientY-this.controlBox.start.y;if("leftUp"==this.controlBox.btnName){if(this.rate){let t=this.rate.split(":")[0]/this.rate.split(":")[1];t>=1?(o=this.toolBox.x+i,e=this.toolBox.y+i/t):(o=this.toolBox.x+l*t,e=this.toolBox.y+l)}else o=this.toolBox.x+i,e=this.toolBox.y+l;this.toolBox.width=this.controlBox.start.width-i,this.toolBox.height=this.controlBox.start.height-l}if("rightUp"==this.controlBox.btnName){if(this.rate){let t=this.rate.split(":")[0]/this.rate.split(":")[1];t>=1?(o=this.toolBox.x,e=this.toolBox.y-i/t):(o=this.toolBox.x,e=this.toolBox.y+l)}else o=this.toolBox.x,e=this.toolBox.y+l;this.toolBox.width=this.controlBox.start.width+i,this.toolBox.height=this.controlBox.start.height-l}if("rightDown"==this.controlBox.btnName&&(o=this.toolBox.x,e=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+i,this.toolBox.height=this.controlBox.start.height+l),"leftDown"==this.controlBox.btnName){if(this.rate){let t=this.rate.split(":")[0]/this.rate.split(":")[1];t>=1?(o=this.toolBox.x+i,e=this.toolBox.y):(o=this.toolBox.x+-l*t,e=this.toolBox.y)}else o=this.toolBox.x+i,e=this.toolBox.y;this.toolBox.width=this.controlBox.start.width-i,this.toolBox.height=this.controlBox.start.height+l}"topCenter"==this.controlBox.btnName&&(o=this.toolBox.x,e=this.toolBox.y+l,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height-l),"downCenter"==this.controlBox.btnName&&(o=this.toolBox.x,e=this.toolBox.y,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height+l),"leftCenter"==this.controlBox.btnName&&(o=this.toolBox.x+i,e=this.toolBox.y,this.toolBox.width=this.controlBox.start.width-i,this.toolBox.height=this.controlBox.start.height),"rightCenter"==this.controlBox.btnName&&(o=this.toolBox.x,e=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+i,this.toolBox.height=this.controlBox.start.height),this.drawControlBox(this.toolBox.width,this.toolBox.height,o,e)}t.stopPropagation()},changeFileName(t,o){let e=t.lastIndexOf(".");return t.substr(0,e+1)+("jpeg"===o?"jpg":o)},cropPicture(t){let o=this;if(this.drawImg.img){let e=this.$refs.canvas;if(this.WatermarkText&&!t){let t=e.getContext("2d");t.font=this.WatermarkTextFont,t.fillStyle=this.WatermarkTextColor,t.textAlign="right",t.textBaseline="bottom",t.fillText(this.WatermarkText,this.toolBox.x+this.toolBox.width*this.WatermarkTextX,this.toolBox.y+this.toolBox.height*this.WatermarkTextY)}let i=new Image;!0===this.crossOrigin&&(i.crossOrigin=this.crossOriginHeader),i.src=e.toDataURL(`image/${this.fileType}`,o.quality),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:(t,i,l)=>{window.atob?setTimeout((()=>{let s,a=atob(e.toDataURL(i,l).split(",")[1]),r=a.length,h=new Uint8Array(r);for(let t=0;t<r;t++)h[t]=a.charCodeAt(t);try{s=new Blob([h],{type:`image/${o.fileType}`})}catch(n){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"==n.name&&window.BlobBuilder){let t=new(0,window.BlobBuilder);t.append(h.buffer),s=t.getBlob(`image/${o.fileType}`)}"InvalidStateError"==n.name&&(s=new Blob([h.buffer],{type:`image/${o.fileType}`}))}t(s)}),200):t(!1,{type:`image/${o.fileType}`})}}),e.toBlob((e=>{if(e){let l=new FileReader;l.readAsDataURL(e),l.onload=()=>{let e=setInterval((()=>{if(2==l.readyState){clearInterval(e);let l=document.createElement("canvas"),s=l.getContext("2d");if(1==o.originalGraph){let t=o.drawImg.width/o.drawImg.swidth,e=o.toolBox.width/t,i=o.toolBox.height/t;l.width=e,l.height=i;let a=(o.toolBox.x-o.drawImg.x)/t,r=(o.toolBox.y-o.drawImg.y)/t,h=o.drawImg.swidth,n=o.drawImg.sheight;s.translate(-a,-r),s.drawImage(o.drawImg.img,0,0,h,n)}else{l.width=o.toolBox.width,l.height=o.toolBox.height;let t=o.toolBox;if(o.rate){let e=o.rate.split(":")[0]/o.rate.split(":")[1];o.rate.split(":")[0]>=o.rate.split(":")[1]?s.drawImage(i,t.x,t.y,t.width,t.width*e,0,0,t.width,t.width*e):s.drawImage(i,t.x,t.y,t.width,t.width/e,0,0,t.width,t.width/e)}else s.drawImage(i,t.x,t.y,t.width,t.height,0,0,t.width,t.height)}l.toBlob((e=>{let i=o.changeFileName(o.fileName,o.fileType);t?o.previewMode&&o.$emit("onPrintImg",{index:o.index,fileName:i,blob:e,file:o.dataURLtoFile(l.toDataURL(`image/${o.fileType}`,o.quality),i),dataURL:l.toDataURL(`image/${o.fileType}`,o.quality)}):(o.handleClose(),o.$emit("cutDown",{index:o.index,fileName:i,blob:e,file:o.dataURLtoFile(l.toDataURL(`image/${o.fileType}`,o.quality),i),dataURL:l.toDataURL(`image/${o.fileType}`,o.quality)}))}),`image/${o.fileType}`,o.quality)}}),200)}}else{let e=document.createElement("canvas");e.width=o.toolBox.width,e.height=o.toolBox.height;let l=e.getContext("2d"),s=o.toolBox;if(o.rate){let t=o.rate.split(":")[0]/o.rate.split(":")[1];l.drawImage(i,s.x,s.y,s.width,s.width*t,0,0,s.width,s.width*t)}else l.drawImage(i,s.x,s.y,s.width,s.height,0,0,s.width,s.height);let a=o.changeFileName(o.fileName,o.fileType);t?o.$emit("onPrintImg",{fileName:a,dataURL:e.toDataURL(`image/${o.fileType}`,o.quality)}):(o.handleClose(),o.$emit("cutDown",{fileName:a,dataURL:e.toDataURL(`image/${o.fileType}`,o.quality)}))}}),`image/${o.fileType}`,o.quality)}else t||o.$emit("error",{err:1,msg:"No picture selected"})},scrollBarControlMove(t){if(this.rotateControl.active){let o=t.pageX-this.rotateControl.start.x,e=this.rotateControl.start.position+o;e<=0&&(e=0),e>=200&&(e=200),this.rotateControl.position=e,this.rotateImg.angle=(e-100)/100*180,this.printImg()}},scrollBarControlOn(t){this.rotateControl.active=!0,this.rotateControl.start.x=t.pageX,this.rotateControl.start.y=t.pageY,this.rotateControl.start.position=this.rotateControl.position},scrollBarControlOff(){this.rotateControl.active=!1}},computed:{showToolBoxWidth(){let t;return t=this.originalGraph?this.toolBox.width/(this.drawImg.width/this.drawImg.swidth):this.toolBox.width,Number(t).toFixed(0)},showToolBoxHeight(){let t;return t=this.originalGraph?this.toolBox.height/(this.drawImg.width/this.drawImg.swidth):this.toolBox.height,Number(t).toFixed(0)},showToolBoxX(){let t;return t=this.toolBoxPosition.x,Number(t).toFixed(0)},showToolBoxY(){let t;return t=this.toolBoxPosition.y,Number(t).toFixed(0)}}},$={class:"toolMain"},L={key:0,class:"tool-title"},U={class:"tips"},W={key:0,class:"dockBtn"},P={key:4,class:"dockBtnScrollBar"},H={class:"toolBoxControlBox"},q={class:"controlBox"},D={class:"selectArea"},F={class:"copyright"},N={key:0,target:"_blank",href:"https://github.com/acccccccb/vue-img-cutter",rel:"nofollow"},R=["width","height"],S=["width","height"],z={class:"i-dialog-footer",style:{height:"40px"}},A=["accept"],_={key:0,class:"btn btn-primary btn-primary-plain"},E={class:"btn-group fr"},j=["disabled"];const Y=t(O,[["render",function(t,w,u,p,B,f){return e(),o("div",null,[!0===u.showChooseBtn&&!0===u.isModal?(e(),o("div",{key:0,onClick:w[0]||(w[0]=(...t)=>f.handleOpen&&f.handleOpen(...t))},[s(t.$slots,"openImgCutter",{},void 0,!0),s(t.$slots,"open",{},void 0,!0)])):i("",!0),t.$slots.openImgCutter||t.$slots.open||!0!==u.isModal?i("",!0):(e(),o("button",{key:1,type:"button",class:"btn btn-primary",onClick:w[1]||(w[1]=(...t)=>f.handleOpen&&f.handleOpen(...t))},a(u.label),1)),l(d,{name:"fade"},{default:r((()=>[B.visible?(e(),o("div",{key:0,class:h(!0===u.isModal?"mask vue-img-cutter":""),ref:"mask"},[B.visible?(e(),o("div",{key:0,class:h(!0===u.isModal?"dialogBoxModal":"dialogBox")},[l(d,{name:"fade","enter-class":"fade-in-enter","enter-active-class":"fade-in-active","leave-class":"fade-out-enter","leave-active-class":"fade-out-active"},{default:r((()=>[n("div",{ref:"dialogMainModalRef",class:h(!0===u.isModal?"dialogMainModal":"dialogMain"),style:g("width:"+(!0===u.isModal?u.boxWidth+32:u.boxWidth)+"px")},[n("div",$,[!0===u.isModal?(e(),o("div",L,[w[37]||(w[37]=m(" 图片裁剪 ")),n("span",{class:"closeIcon",onClick:w[2]||(w[2]=(...t)=>f.handleClose&&f.handleClose(...t))},"×")])):i("",!0),n("div",{ref:"toolBox",style:g("height:"+u.boxHeight+"px;width:"+u.boxWidth+"px"),onMousemove:w[30]||(w[30]=(...t)=>f.controlBtnMouseMove&&f.controlBtnMouseMove(...t)),onMouseup:w[31]||(w[31]=(...t)=>f.controlBtnMouseUp&&f.controlBtnMouseUp(...t)),onMouseleave:w[32]||(w[32]=(...t)=>f.controlBtnMouseUp&&f.controlBtnMouseUp(...t)),class:"toolBox"},[x(n("div",U,[n("div",{class:"btn btn-warning btn-xs",onClick:w[3]||(w[3]=(...t)=>f.chooseImg&&f.chooseImg(...t))},a(u.label),1)],512),[[c,!B.drawImg.img&&!0===u.showChooseBtn]]),1==u.tool?x((e(),o("div",{key:0,class:"dockMain",style:g("background:"+u.toolBgc),onMouseenter:w[14]||(w[14]=(...t)=>f.dropImgOff&&f.dropImgOff(...t))},[u.rate?(e(),o("div",W,[s(t.$slots,"ratio",{},(()=>[w[38]||(w[38]=m(" Ratio: "))]),!0),m(" "+a(u.rate),1)])):i("",!0),n("div",{class:"dockBtn",onClick:w[4]||(w[4]=(...t)=>f.scaleReset&&f.scaleReset(...t))},[s(t.$slots,"scaleReset",{},(()=>[w[39]||(w[39]=m(" Scale: "))]),!0),m(" "+a(B.drawImg.swidth>0?(B.drawImg.width/B.drawImg.swidth).toFixed(2):"-"),1)]),!1===u.originalGraph?(e(),o("div",{key:1,onClick:w[5]||(w[5]=t=>f.turnImg(-90)),class:"dockBtn"},[s(t.$slots,"turnLeft",{},(()=>[w[40]||(w[40]=m(" ↳ "))]),!0)])):i("",!0),!1===u.originalGraph?(e(),o("div",{key:2,onClick:w[6]||(w[6]=t=>f.turnImg(90)),class:"dockBtn"},[s(t.$slots,"turnRight",{},(()=>[w[41]||(w[41]=m(" ↲ "))]),!0)])):i("",!0),!1===u.originalGraph?(e(),o("div",{key:3,onClick:w[7]||(w[7]=t=>f.turnReset()),class:"dockBtn"},[s(t.$slots,"reset",{},(()=>[w[42]||(w[42]=m(" ↻ "))]),!0)])):i("",!0),!1===u.originalGraph?(e(),o("div",P,[n("div",{ref:"dockBtnScrollControl",onMousemove:w[8]||(w[8]=(...t)=>f.scrollBarControlMove&&f.scrollBarControlMove(...t)),onMousedown:w[9]||(w[9]=(...t)=>f.scrollBarControlOn&&f.scrollBarControlOn(...t)),onMouseleave:w[10]||(w[10]=(...t)=>f.scrollBarControlOff&&f.scrollBarControlOff(...t)),onMouseup:w[11]||(w[11]=(...t)=>f.scrollBarControlOff&&f.scrollBarControlOff(...t)),style:g("left:"+B.rotateControl.position+"px"),class:"scrollBarControl"},null,36),1==B.rotateControl.active?(e(),o("div",{key:0,class:"scrollBarText",style:g("left:"+B.rotateControl.position+"px")},a(B.rotateImg.angle.toFixed(0)+"°"),5)):i("",!0)])):i("",!0),!1===u.originalGraph?(e(),o("div",{key:5,onClick:w[12]||(w[12]=(...t)=>f.flipHorizontal&&f.flipHorizontal(...t)),class:"dockBtn"},[s(t.$slots,"flipHorizontal",{},(()=>[w[43]||(w[43]=m(" ⇆ "))]),!0)])):i("",!0),!1===u.originalGraph?(e(),o("div",{key:6,onClick:w[13]||(w[13]=(...t)=>f.flipVertically&&f.flipVertically(...t)),class:"dockBtn"},[s(t.$slots,"flipVertically",{},(()=>[w[44]||(w[44]=m(" ⇅ "))]),!0)])):i("",!0)],36)),[[c,B.drawImg.img&&!0!==B.dropImg.active&&1==B.controlBox.disable&&1==B.toolBox.disable]]):i("",!0),x(n("div",{ref:"toolBoxControl",onMousedown:w[23]||(w[23]=(...t)=>f.toolBoxMouseDown&&f.toolBoxMouseDown(...t)),onMouseup:w[24]||(w[24]=(...t)=>f.toolBoxMouseUp&&f.toolBoxMouseUp(...t)),onMousemove:w[25]||(w[25]=(...t)=>f.toolBoxMouseMove&&f.toolBoxMouseMove(...t)),onMouseleave:w[26]||(w[26]=(...t)=>f.toolBoxMouseLeave&&f.toolBoxMouseLeave(...t)),class:"toolBoxControl",style:g({pointerEvents:u.moveAble?"auto":"none"})},[n("div",H,[n("div",q,[w[45]||(w[45]=n("div",{class:"controlBoxInnerLine controlBoxInnerLineTop"},null,-1)),w[46]||(w[46]=n("div",{class:"controlBoxInnerLine controlBoxInnerLineBottom"},null,-1)),w[47]||(w[47]=n("div",{class:"controlBoxInnerLine controlBoxInnerLineLeft"},null,-1)),w[48]||(w[48]=n("div",{class:"controlBoxInnerLine controlBoxInnerLineRight"},null,-1)),n("div",D," 宽:"+a(f.showToolBoxWidth)+" 高:"+a(f.showToolBoxHeight)+" (x:"+a(f.showToolBoxX)+",y:"+a(f.showToolBoxY)+") ",1),!0===u.sizeChange?(e(),o("div",{key:0,"data-name":"leftUp",onMousedown:w[15]||(w[15]=t=>f.controlBtnMouseDown(t,"leftUp")),class:"leftUp controlBtn"},null,32)):i("",!0),!0===u.sizeChange?(e(),o("div",{key:1,"data-name":"leftDown",onMousedown:w[16]||(w[16]=t=>f.controlBtnMouseDown(t,"leftDown")),class:"leftDown controlBtn"},null,32)):i("",!0),!0===u.sizeChange?(e(),o("div",{key:2,"data-name":"rightUp",onMousedown:w[17]||(w[17]=t=>f.controlBtnMouseDown(t,"rightUp")),class:"rightUp controlBtn"},null,32)):i("",!0),!0===u.sizeChange?(e(),o("div",{key:3,"data-name":"rightDown",onMousedown:w[18]||(w[18]=t=>f.controlBtnMouseDown(t,"rightDown")),class:"rightDown controlBtn"},null,32)):i("",!0),!0===u.sizeChange&&!u.rate&&B.toolBox.width>20?(e(),o("div",{key:4,"data-name":"topCenter",onMousedown:w[19]||(w[19]=t=>f.controlBtnMouseDown(t,"topCenter")),class:"topCenter controlBtn"},null,32)):i("",!0),!0===u.sizeChange&&!u.rate&&B.toolBox.width>20?(e(),o("div",{key:5,"data-name":"downCenter",onMousedown:w[20]||(w[20]=t=>f.controlBtnMouseDown(t,"downCenter")),class:"downCenter controlBtn"},null,32)):i("",!0),!0===u.sizeChange&&!u.rate&&B.toolBox.height>20?(e(),o("div",{key:6,"data-name":"leftCenter",onMousedown:w[21]||(w[21]=t=>f.controlBtnMouseDown(t,"leftCenter")),class:"leftCenter controlBtn"},null,32)):i("",!0),!0===u.sizeChange&&!u.rate&&B.toolBox.height>20?(e(),o("div",{key:7,"data-name":"rightCenter",onMousedown:w[22]||(w[22]=t=>f.controlBtnMouseDown(t,"rightCenter")),class:"rightCenter controlBtn"},null,32)):i("",!0)]),w[49]||(w[49]=n("div",{class:"toolBoxControlLine toolBoxControlLineItem-1"},null,-1)),w[50]||(w[50]=n("div",{class:"toolBoxControlLine toolBoxControlLineItem-2"},null,-1)),w[51]||(w[51]=n("div",{class:"toolBoxControlLine toolBoxControlLineItem-3"},null,-1)),w[52]||(w[52]=n("div",{class:"toolBoxControlLine toolBoxControlLineItem-4"},null,-1))])],36),[[c,null!=B.drawImg.img]]),n("div",F,[u.DoNotDisplayCopyright?i("",!0):(e(),o("a",N," vue-img-cutter "+a(B.version),1))]),n("canvas",{class:"canvasSelectBox",ref:"canvasSelectBox",width:u.boxWidth,onMousedown:w[27]||(w[27]=(...t)=>f.dropImgOn&&f.dropImgOn(...t)),onMouseup:w[28]||(w[28]=(...t)=>f.dropImgOff&&f.dropImgOff(...t)),onMousemove:w[29]||(w[29]=(...t)=>f.dropImgMove&&f.dropImgMove(...t)),height:u.boxHeight},null,40,R),n("canvas",{class:"canvas",ref:"canvas",width:u.boxWidth,height:u.boxHeight},null,8,S)],36)]),n("div",z,[n("input",{onChange:w[33]||(w[33]=(...t)=>f.putImgToCanv&&f.putImgToCanv(...t)),ref:"inputFile",type:"file",accept:u.accept,style:{width:"1px",height:"1px",border:"none",opacity:"0"}},null,40,A),n("span",{onClick:w[34]||(w[34]=(...t)=>f.chooseImg&&f.chooseImg(...t))},[s(t.$slots,"choose",{},(()=>[!0===u.showChooseBtn?(e(),o("div",_,a(u.label),1)):i("",!0)]),!0)]),n("div",E,[n("span",{onClick:w[35]||(w[35]=(...t)=>f.handleClose&&f.handleClose(...t))},[s(t.$slots,"cancel",{},(()=>[w[53]||(w[53]=n("button",{type:"button",class:"btn btn-default"},"取消",-1))]),!0)]),n("span",{onClick:w[36]||(w[36]=t=>f.cropPicture(!1))},[s(t.$slots,"confirm",{},(()=>[n("button",{type:"button",class:"btn btn-primary",style:{"margin-left":"15px"},disabled:!B.drawImg.img}," 确定 ",8,j)]),!0)])])])],6)])),_:3}),w[54]||(w[54]=n("div",{style:{clear:"both"}},null,-1))],2)):i("",!0)],2)):i("",!0)])),_:3})])}],["__scopeId","data-v-2274970f"]]),X={class:"cutter-container"},G={class:"cutter-component"},V={class:"title"},K={key:0,class:"preview-container"},J={class:"title"},Q=["src"],Z=t(w({__name:"ArtCutterImg",props:{isModal:{type:Boolean,default:!1},tool:{type:Boolean,default:!0},toolBgc:{default:"#fff"},title:{default:"图像裁剪"},previewTitle:{default:"图像预览"},showPreview:{type:Boolean,default:!0},boxWidth:{default:700},boxHeight:{default:458},cutWidth:{default:470},cutHeight:{default:270},sizeChange:{type:Boolean,default:!0},moveAble:{type:Boolean,default:!0},imgMove:{type:Boolean,default:!0},scaleAble:{type:Boolean,default:!0},originalGraph:{type:Boolean,default:!0},crossOrigin:{type:Boolean,default:!0},fileType:{default:"png"},quality:{default:.9},watermarkText:{default:""},watermarkFontSize:{default:20},watermarkColor:{default:"#ffffff"},saveCutPosition:{type:Boolean,default:!0},previewMode:{type:Boolean,default:!0},imgUrl:{}},emits:["update:imgUrl","error","imageLoadComplete","imageLoadError"],setup(t,{emit:s}){const h=t,d=s,c=u(""),w=u(),M=p((()=>({...h,WatermarkText:h.watermarkText,WatermarkFontSize:h.watermarkFontSize,WatermarkColor:h.watermarkColor})));async function T(){if(h.imgUrl)try{await(t=h.imgUrl,new Promise(((o,e)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>o(),i.onerror=e,i.src=t}))),w.value?.handleOpen({name:"封面图片",src:h.imgUrl})}catch(o){d("error",o)}var t}function k(t){c.value=t.dataURL}function O(t){d("update:imgUrl",t.dataURL)}function $(t){d("imageLoadComplete",t)}function L(t){d("error",t),d("imageLoadError",t)}function U(){c.value=""}function W(){const t=document.createElement("a");t.href=c.value,t.download="image.png",t.click()}return B((()=>{h.imgUrl&&(c.value=h.imgUrl,T())})),f((()=>h.imgUrl),(t=>{t&&(c.value=t,T())})),(t,s)=>{const h=C,d=y("ripple");return e(),o("div",X,[n("div",G,[n("div",V,a(t.title),1),l(I(Y),v({ref_key:"imgCutterModal",ref:w,onCutDown:O,onOnPrintImg:k,onOnImageLoadComplete:$,onOnImageLoadError:L,onOnClearAll:U},M.value,{class:"img-cutter"}),{choose:r((()=>[x((e(),b(h,{type:"primary",plain:""},{default:r((()=>s[0]||(s[0]=[m("选择图片")]))),_:1,__:[0]})),[[d]])])),cancel:r((()=>[x((e(),b(h,{type:"danger",plain:""},{default:r((()=>s[1]||(s[1]=[m("清除")]))),_:1,__:[1]})),[[d]])])),confirm:r((()=>s[2]||(s[2]=[n("div",null,null,-1)]))),_:1},16)]),t.showPreview?(e(),o("div",K,[n("div",J,a(t.previewTitle),1),n("div",{class:"preview-box",style:g({width:`${M.value.cutWidth}px`,height:`${M.value.cutHeight}px`})},[c.value?(e(),o("img",{key:0,class:"preview-img",src:c.value,alt:"预览图"},null,8,Q)):i("",!0)],4),x((e(),b(h,{class:"download-btn",onClick:W,disabled:!c.value},{default:r((()=>s[3]||(s[3]=[m("下载图片")]))),_:1,__:[3]},8,["disabled"])),[[d]])])):i("",!0)])}}}),[["__scopeId","data-v-ce01ee07"]]),tt={class:"page-content"},ot=w({__name:"index",setup(t){const i=u(T),s=t=>{},a=t=>{},r=t=>{};return(t,h)=>{const n=Z;return e(),o("div",tt,[l(n,{style:{"margin-top":"20px"},imgUrl:I(i),"onUpdate:imgUrl":h[0]||(h[0]=t=>M(i)?i.value=t:null),boxWidth:540,boxHeight:300,cutWidth:360,cutHeight:200,quality:1,tool:!0,watermarkText:"My Watermark",watermarkColor:"#ff0000",showPreview:!0,originalGraph:!1,previewTitle:"预览效果",onError:s,onImageLoadComplete:a,onImageLoadError:r},null,8,["imgUrl"])])}}});export{ot as default};
