import{u as e,_ as a,a as l,b as t,A as u}from"./useCheckedColumns-Czep2lLV.js";import{k as o,m as n,B as r,I as s,C as i,_ as d}from"./index-BHy-qhsq.js";/* empty css                */import{_ as m}from"./ArtIconSelector-CnoOplJB.js";/* empty css               *//* empty css               *//* empty css                       *//* empty css                        */import{_ as p}from"./ArtTable-BVlC0wWp.js";/* empty css                    */import{Y as c,s as f,h,r as b,m as _,o as v,l as g,I as k,i as y,d as V,J as w,e as j,f as C,v as I,u as L,a9 as A,K as U,L as x,j as E,P as H,c as M,$ as N,a0 as S,_ as T,aa as q,a8 as B,Q as O,X as R,R as z,as as $,ar as F,a2 as K,a1 as Y,S as D,au as J,aq as P,N as Q,n as W,p as X,ad as Z,av as G,ae as ee}from"./vendor-CbDhNKi9.js";import"./formEnum-BLgiZVxV.js";import"./vue-draggable-plus-JPhlahyT.js";/* empty css                       */import"./iconfont-Cb643lm4.js";/* empty css                   *//* empty css                 */const ae=n(),le={class:"menu-page",id:"table-full-screen"},te={class:"dialog-footer"},ue=d(h({name:"Menus",__name:"index",setup(n){const{hasAuth:d}=(()=>{const e=c(),{isFrontendMode:a}=o(),{info:l}=f(ae),t=l.value?.buttons??[],u=Array.isArray(e.meta.authList)?e.meta.authList:[];return{hasAuth:e=>a.value?t.includes(e):u.some((a=>a?.authMark===e))}})(),{menuList:h}=f(r()),ue=b(!1),oe={name:"",route:""},ne=_({...oe}),re=_({...oe}),se=()=>{Object.assign(ne,{...oe}),Object.assign(re,{...oe}),Ve()},ie=()=>{Object.assign(re,{...ne}),Ve()},de=[{label:"菜单名称",prop:"name",type:"input",config:{clearable:!0}},{label:"路由地址",prop:"route",type:"input",config:{clearable:!0}}],me=[{label:"勾选",type:"selection"},{label:"用户名",prop:"avatar"},{label:"手机号",prop:"mobile"},{label:"性别",prop:"sex"},{label:"部门",prop:"dep"},{label:"状态",prop:"status"},{label:"创建日期",prop:"create_time"},{label:"操作",prop:"operation"}],pe=e=>e.children&&e.children.length>0?"info":e.meta?.link&&e.meta?.isIframe?"success":e.path?"primary":e.meta?.link?"warning":void 0,{columnChecks:ce,columns:fe}=e((()=>[{prop:"meta.title",label:"菜单名称",minWidth:120,formatter:e=>i(e.meta?.title)},{prop:"type",label:"菜单类型",formatter:e=>X(Z,{type:pe(e)},(()=>(e=>e.children&&e.children.length>0?"目录":e.meta?.link&&e.meta?.isIframe?"菜单（内嵌）":e.path&&!e.meta?.link?"菜单":e.meta?.link?"菜单（外链）":void 0)(e)))},{prop:"path",label:"路由",formatter:e=>e.meta?.link||e.path||""},{prop:"meta.authList",label:"可操作权限",formatter:e=>X("div",{},e.meta.authList?.map(((e,a)=>X(G,{placement:"top-start",title:"操作",width:200,trigger:"click",key:a},{default:()=>X("div",{style:"margin: 0; text-align: right"},[X(x,{size:"small",type:"primary",onClick:()=>Ue("button",e)},{default:()=>"编辑"}),X(x,{size:"small",type:"danger",onClick:()=>He()},{default:()=>"删除"})]),reference:()=>X(x,{class:"small-btn"},{default:()=>e.title})}))))},{prop:"date",label:"编辑时间",formatter:()=>"2022-3-12 12:00:00"},{prop:"status",label:"隐藏菜单",formatter:e=>X(Z,{type:e.meta.isHide?"danger":"info"},(()=>e.meta.isHide?"是":"否"))},{prop:"operation",label:"操作",width:180,formatter:e=>X("div",[d("menu/add")&&X(u,{type:"add",onClick:()=>Ue("menu")}),d("menu/update")&&X(u,{type:"edit",onClick:()=>Le("edit",e)}),d("menu/del")&&X(u,{type:"delete",onClick:()=>Ee()})])}])),he=()=>{Ve()},be=b(!1),_e=_({name:"",path:"",label:"",icon:"",isEnable:!0,sort:1,isMenu:!0,keepAlive:!0,isHidden:!0,link:"",isIframe:!1,authName:"",authLabel:"",authIcon:"",authSort:1}),ve=b(s.UNICODE),ge=b("menu"),ke=_({name:[{required:!0,message:"请输入菜单名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],path:[{required:!0,message:"请输入路由地址",trigger:"blur"}],label:[{required:!0,message:"输入权限标识",trigger:"blur"}],authName:[{required:!0,message:"请输入权限名称",trigger:"blur"}],authLabel:[{required:!0,message:"请输入权限权限标识",trigger:"blur"}]}),ye=b([]);v((()=>{Ve()}));const Ve=()=>{ue.value=!0,setTimeout((()=>{ye.value=h.value,ue.value=!1}),500)},we=g((()=>{const e=a=>a.filter((a=>{const l=re.name?.toLowerCase().trim()||"",t=re.route?.toLowerCase().trim()||"",u=i(a.meta?.title||"").toLowerCase(),o=(a.path||"").toLowerCase(),n=!l||u.includes(l),r=!t||o.includes(t);if(a.children&&a.children.length>0){const l=e(a.children);if(l.length>0)return a.children=l,!0}return n&&r}));return e(ye.value)})),je=b(!1),Ce=b(),Ie=g((()=>{const e="menu"===ge.value?"菜单":"权限";return je.value?`编辑${e}`:`新建${e}`})),Le=(e,a)=>{Ue("menu",a,!0)},Ae=()=>{},Ue=(e,a,l=!1)=>{be.value=!0,ge.value=e,je.value=!1,Ne.value=l,xe(),a&&(je.value=!0,W((()=>{"menu"===e?(_e.name=i(a.meta.title),_e.path=a.path,_e.label=a.name,_e.icon=a.meta.icon,_e.sort=a.meta.sort||1,_e.isMenu=a.meta.isMenu,_e.keepAlive=a.meta.keepAlive,_e.isHidden=a.meta.isHidden||!0,_e.isEnable=a.meta.isEnable||!0,_e.link=a.meta.link,_e.isIframe=a.meta.isIframe||!1):(_e.authName=a.title,_e.authLabel=a.authMark,_e.authIcon=a.icon||"",_e.authSort=a.sort||1)})))},xe=()=>{Ce.value?.resetFields(),Object.assign(_e,{name:"",path:"",label:"",icon:"",sort:1,isMenu:!0,keepAlive:!0,isHidden:!0,link:"",isIframe:!1,authName:"",authLabel:"",authIcon:"",authSort:1})},Ee=async()=>{try{await ee.confirm("确定要删除该菜单吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),Q.success("删除成功")}catch(e){"cancel"!==e&&Q.error("删除失败")}},He=async()=>{try{await ee.confirm("确定要删除该权限吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),Q.success("删除成功")}catch(e){"cancel"!==e&&Q.error("删除失败")}},Me=g((()=>!(!je.value||"button"!==ge.value)||(!(!je.value||"menu"!==ge.value)||!(je.value||"menu"!==ge.value||!Ne.value)))),Ne=b(!1),Se=b(!1),Te=b(),qe=()=>{Se.value=!Se.value,W((()=>{Te.value&&Te.value[Se.value?"expandAll":"collapseAll"]()}))};return(e,u)=>{const o=a,n=l,r=T,s=p,i=F,d=$,c=z,f=D,h=Y,b=K,_=m,v=J,g=P,W=O,X=B,Z=A,G=t,ee=k("auth"),ae=k("ripple");return V(),y(G,null,{default:w((()=>[j("div",le,[C(o,{filter:L(ne),"onUpdate:filter":u[0]||(u[0]=e=>I(ne)?ne.value=e:null),items:de,showExpand:!1,onReset:se,onSearch:ie},null,8,["filter"]),C(Z,{shadow:"never",class:"art-table-card"},{default:w((()=>[C(n,{columnList:me,showZebra:!1,columns:L(ce),"onUpdate:columns":u[2]||(u[2]=e=>I(ce)?ce.value=e:null),onRefresh:he},{left:w((()=>[U((V(),y(L(x),{onClick:u[1]||(u[1]=e=>Ue("menu",null,!0))},{default:w((()=>u[19]||(u[19]=[E(" 添加菜单 ")]))),_:1,__:[19]})),[[ee,"menu/add"],[ae]]),U((V(),y(L(x),{onClick:qe},{default:w((()=>[E(H(L(Se)?"收起":"展开"),1)])),_:1})),[[ae]])])),_:1},8,["columns"]),C(s,{rowKey:"path",ref_key:"tableRef",ref:Te,loading:L(ue),data:L(we),marginTop:10,stripe:!1},{default:w((()=>[(V(!0),M(N,null,S(L(fe),(e=>(V(),y(r,q({key:e.prop||e.type},{ref_for:!0},e),null,16)))),128))])),_:1},8,["loading","data"]),C(X,{title:L(Ie),modelValue:L(be),"onUpdate:modelValue":u[18]||(u[18]=e=>I(be)?be.value=e:null),width:"700px","align-center":""},{footer:w((()=>[j("span",te,[C(L(x),{onClick:u[16]||(u[16]=e=>be.value=!1)},{default:w((()=>u[22]||(u[22]=[E("取 消")]))),_:1,__:[22]}),C(L(x),{type:"primary",onClick:u[17]||(u[17]=e=>(async()=>{Ce.value&&await Ce.value.validate((async e=>{if(e)try{je.value,Q.success((je.value?"编辑":"新增")+"成功"),be.value=!1}catch{Q.error((je.value?"编辑":"新增")+"失败")}}))})())},{default:w((()=>u[23]||(u[23]=[E("确 定")]))),_:1,__:[23]})])])),default:w((()=>[C(W,{ref_key:"formRef",ref:Ce,model:L(_e),rules:L(ke),"label-width":"85px"},{default:w((()=>[C(c,{label:"菜单类型"},{default:w((()=>[C(d,{modelValue:L(ge),"onUpdate:modelValue":u[3]||(u[3]=e=>I(ge)?ge.value=e:null),disabled:L(Me)},{default:w((()=>[C(i,{value:"menu",label:"menu"},{default:w((()=>u[20]||(u[20]=[E("菜单")]))),_:1,__:[20]}),C(i,{value:"button",label:"button"},{default:w((()=>u[21]||(u[21]=[E("权限")]))),_:1,__:[21]})])),_:1},8,["modelValue","disabled"])])),_:1}),"menu"===L(ge)?(V(),M(N,{key:0},[C(b,{gutter:20},{default:w((()=>[C(h,{span:12},{default:w((()=>[C(c,{label:"菜单名称",prop:"name"},{default:w((()=>[C(f,{modelValue:L(_e).name,"onUpdate:modelValue":u[4]||(u[4]=e=>L(_e).name=e),placeholder:"菜单名称"},null,8,["modelValue"])])),_:1})])),_:1}),C(h,{span:12},{default:w((()=>[C(c,{label:"路由地址",prop:"path"},{default:w((()=>[C(f,{modelValue:L(_e).path,"onUpdate:modelValue":u[5]||(u[5]=e=>L(_e).path=e),placeholder:"路由地址"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),C(b,{gutter:20},{default:w((()=>[C(h,{span:12},{default:w((()=>[C(c,{label:"权限标识",prop:"label"},{default:w((()=>[C(f,{modelValue:L(_e).label,"onUpdate:modelValue":u[6]||(u[6]=e=>L(_e).label=e),placeholder:"权限标识"},null,8,["modelValue"])])),_:1})])),_:1}),C(h,{span:12},{default:w((()=>[C(c,{label:"图标",prop:"icon"},{default:w((()=>[C(_,{iconType:L(ve),defaultIcon:L(_e).icon,width:"229px"},null,8,["iconType","defaultIcon"])])),_:1})])),_:1})])),_:1}),C(b,{gutter:20},{default:w((()=>[C(h,{span:12},{default:w((()=>[C(c,{label:"菜单排序",prop:"sort",style:{width:"100%"}},{default:w((()=>[C(v,{modelValue:L(_e).sort,"onUpdate:modelValue":u[7]||(u[7]=e=>L(_e).sort=e),style:{width:"100%"},onChange:Ae,min:1,"controls-position":"right"},null,8,["modelValue"])])),_:1})])),_:1}),C(h,{span:12},{default:w((()=>[C(c,{label:"外部链接",prop:"link"},{default:w((()=>[C(f,{modelValue:L(_e).link,"onUpdate:modelValue":u[8]||(u[8]=e=>L(_e).link=e),placeholder:"外部链接/内嵌地址(https://www.baidu.com)"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),C(b,{gutter:20},{default:w((()=>[C(h,{span:5},{default:w((()=>[C(c,{label:"是否启用",prop:"isEnable"},{default:w((()=>[C(g,{modelValue:L(_e).isEnable,"onUpdate:modelValue":u[9]||(u[9]=e=>L(_e).isEnable=e)},null,8,["modelValue"])])),_:1})])),_:1}),C(h,{span:5},{default:w((()=>[C(c,{label:"页面缓存",prop:"keepAlive"},{default:w((()=>[C(g,{modelValue:L(_e).keepAlive,"onUpdate:modelValue":u[10]||(u[10]=e=>L(_e).keepAlive=e)},null,8,["modelValue"])])),_:1})])),_:1}),C(h,{span:5},{default:w((()=>[C(c,{label:"是否显示",prop:"isHidden"},{default:w((()=>[C(g,{modelValue:L(_e).isHidden,"onUpdate:modelValue":u[11]||(u[11]=e=>L(_e).isHidden=e)},null,8,["modelValue"])])),_:1})])),_:1}),C(h,{span:5},{default:w((()=>[C(c,{label:"是否内嵌",prop:"isMenu"},{default:w((()=>[C(g,{modelValue:L(_e).isIframe,"onUpdate:modelValue":u[12]||(u[12]=e=>L(_e).isIframe=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})],64)):R("",!0),"button"===L(ge)?(V(),M(N,{key:1},[C(b,{gutter:20},{default:w((()=>[C(h,{span:12},{default:w((()=>[C(c,{label:"权限名称",prop:"authName"},{default:w((()=>[C(f,{modelValue:L(_e).authName,"onUpdate:modelValue":u[13]||(u[13]=e=>L(_e).authName=e),placeholder:"权限名称"},null,8,["modelValue"])])),_:1})])),_:1}),C(h,{span:12},{default:w((()=>[C(c,{label:"权限标识",prop:"authLabel"},{default:w((()=>[C(f,{modelValue:L(_e).authLabel,"onUpdate:modelValue":u[14]||(u[14]=e=>L(_e).authLabel=e),placeholder:"权限标识"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),C(b,{gutter:20},{default:w((()=>[C(h,{span:12},{default:w((()=>[C(c,{label:"权限排序",prop:"authSort",style:{width:"100%"}},{default:w((()=>[C(v,{modelValue:L(_e).authSort,"onUpdate:modelValue":u[15]||(u[15]=e=>L(_e).authSort=e),style:{width:"100%"},onChange:Ae,min:1,"controls-position":"right"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})],64)):R("",!0)])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])])),_:1})])])),_:1})}}}),[["__scopeId","data-v-0e6e1e77"]]);export{ue as default};
