var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,d=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t,n=(e,l)=>{for(var a in l||(l={}))r.call(l,a)&&d(e,a,l[a]);if(t)for(var a of t(l))o.call(l,a)&&d(e,a,l[a]);return e},s=(e,l,a)=>new Promise(((t,r)=>{var o=e=>{try{n(a.next(e))}catch(l){r(l)}},d=e=>{try{n(a.throw(e))}catch(l){r(l)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,d);n((a=a.apply(e,l)).next())}));import{C as i,D as u,_ as c}from"./index-esXo6YLl.js";/* empty css                    */import{_ as m}from"./ArtTable-BLlvKiyK.js";/* empty css               *//* empty css               */import{R as p}from"./roleApi-CCD4IiPQ.js";import{k as f,r as h,s as _,c as b,a2 as v,e as g,E as y,D as k,m as x,t as C,x as w,y as V,z as j,aQ as O,L as N,O as P,S as T,P as L,T as U,aS as I,a_ as M,bb as R,G as S,u as A,a3 as D,a4 as E,ab as $,i as K,a6 as q,a9 as z,bh as B,aw as Q}from"./vendor-C0Cq8Zey.js";/* empty css                   *//* empty css                 */import"./formEnum-BLgiZVxV.js";const F={class:"page-content"},G={class:"dialog-footer"},H={style:{display:"flex","align-items":"center"}},J={key:0},W={key:1},X={class:"dialog-footer"};var Y;const Z=c(f((Y=n({},{name:"Role"}),l(Y,a({__name:"index",setup(e){const l=h(!1),a=h(!1),{menuList:t}=_(i()),r=h(),o=h(!0),d=h(!1),c=b((()=>{const e=l=>{const a=n({},l);if(l.meta&&l.meta.authList&&l.meta.authList.length){const e=l.meta.authList.map((e=>({id:`${l.id}_${e.authMark}`,name:`${l.name}_${e.authMark}`,label:e.title,authMark:e.authMark,isAuth:!0,checked:e.checked||!1})));a.children=a.children?[...a.children,...e]:e}return a.children&&(a.children=a.children.map(e)),a};return t.value.map(e)})),f=h(),Y=v({name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],des:[{required:!0,message:"请输入角色描述",trigger:"blur"}]}),Z=v({roleId:"",roleName:"",roleCode:"",description:"",enabled:!0}),ee=h([]);g((()=>{le()}));const le=()=>s(this,null,(function*(){const e=yield p.getRolePageList({});e.success?ee.value=e.data.records:y.error(e.msg)})),ae=h("add"),te=(e,a)=>{l.value=!0,ae.value=e,"edit"===e&&a?(Z.roleId=a.roleId,Z.roleName=a.roleName,Z.roleCode=a.roleCode,Z.description=a.description,Z.createTime=a.createTime,Z.enabled=1===a.enabled):(Z.roleName="",Z.roleCode="",Z.description="",Z.createTime="",Z.enabled=!0)},re={children:"children",label:e=>{var l;return u(null==(l=e.meta)?void 0:l.title)||""}},oe=e=>s(this,null,(function*(){e&&(yield e.validate((a=>{if(a){const a="add"===ae.value?"新增成功":"修改成功";y.success(a),l.value=!1,e.resetFields()}})))})),de=()=>{y.success("权限保存成功"),a.value=!1},ne=()=>{const e=r.value;if(!e)return;const l=e.store.nodesMap;for(const a in l)l[a].expanded=!o.value;o.value=!o.value},se=()=>{const e=r.value;if(e){if(d.value)e.setCheckedKeys([]);else{const l=ie(c.value);e.setCheckedKeys(l)}d.value=!d.value}},ie=e=>{const l=[],a=e=>{e.forEach((e=>{e.name&&l.push(e.name),e.children&&e.children.length>0&&a(e.children)}))};return a(e),l},ue=()=>{const e=r.value;if(!e)return;const l=e.getCheckedKeys(),a=ie(c.value);d.value=l.length===a.length&&a.length>0};return(e,t)=>{const n=N,s=O,i=L,u=I,p=M,h=R,_=L,b=m,v=E,g=$,ie=D,ce=q,me=B,pe=z,fe=k("ripple");return C(),x("div",F,[w(u,null,{default:V((()=>[w(s,{xs:24,sm:12,lg:6},{default:V((()=>[w(n,{placeholder:"角色名称"})])),_:1}),t[13]||(t[13]=j("div",{style:{width:"12px"}},null,-1)),w(s,{xs:24,sm:12,lg:6,class:"el-col2"},{default:V((()=>[P((C(),T(i,{onClick:le},{default:V((()=>t[11]||(t[11]=[U("搜索")]))),_:1,__:[11]})),[[fe]]),P((C(),T(i,{onClick:t[0]||(t[0]=e=>te("add"))},{default:V((()=>t[12]||(t[12]=[U("新增角色")]))),_:1,__:[12]})),[[fe]])])),_:1})])),_:1,__:[13]}),w(b,{data:A(ee),index:""},{default:V((()=>[w(p,{label:"角色名称",prop:"roleName"}),w(p,{label:"角色编码",prop:"roleCode"}),w(p,{label:"描述",prop:"description"}),w(p,{label:"启用",prop:"enable"},{default:V((e=>[w(h,{type:e.row.enabled?"primary":"info"},{default:V((()=>[U(S(e.row.enabled?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),w(p,{label:"创建时间",prop:"createTime"},{default:V((e=>{return[U(S((l=e.row.createTime,new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/\//g,"-"))),1)];var l})),_:1}),w(p,{fixed:"right",label:"操作",width:"200px"},{default:V((e=>[w(u,null,{default:V((()=>[w(_,{link:"",onClick:t[1]||(t[1]=e=>{a.value=!0})},{default:V((()=>t[14]||(t[14]=[U(" 菜单权限 ")]))),_:1,__:[14]}),w(_,{link:"",onClick:l=>te("edit",e.row)},{default:V((()=>t[15]||(t[15]=[U(" 编辑 ")]))),_:2,__:[15]},1032,["onClick"]),w(_,{link:"",onClick:t[2]||(t[2]=e=>{Q.confirm("确定删除该角色吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then((()=>{y.success("删除成功")}))})},{default:V((()=>t[16]||(t[16]=[U(" 删除 ")]))),_:1,__:[16]})])),_:2},1024)])),_:1})])),_:1},8,["data"]),w(ce,{modelValue:A(l),"onUpdate:modelValue":t[9]||(t[9]=e=>K(l)?l.value=e:null),title:"add"===A(ae)?"新增角色":"编辑角色",width:"30%","align-center":""},{footer:V((()=>[j("div",G,[w(i,{onClick:t[7]||(t[7]=e=>l.value=!1)},{default:V((()=>t[17]||(t[17]=[U("取消")]))),_:1,__:[17]}),w(i,{type:"primary",onClick:t[8]||(t[8]=e=>oe(A(f)))},{default:V((()=>t[18]||(t[18]=[U("提交")]))),_:1,__:[18]})])])),default:V((()=>[w(ie,{ref_key:"formRef",ref:f,model:A(Z),rules:A(Y),"label-width":"120px"},{default:V((()=>[w(v,{label:"角色名称",prop:"roleName"},{default:V((()=>[w(n,{modelValue:A(Z).roleName,"onUpdate:modelValue":t[3]||(t[3]=e=>A(Z).roleName=e)},null,8,["modelValue"])])),_:1}),w(v,{label:"角色编码",prop:"roleCode"},{default:V((()=>[w(n,{modelValue:A(Z).roleCode,"onUpdate:modelValue":t[4]||(t[4]=e=>A(Z).roleCode=e)},null,8,["modelValue"])])),_:1}),w(v,{label:"描述",prop:"roleStatus"},{default:V((()=>[w(n,{modelValue:A(Z).description,"onUpdate:modelValue":t[5]||(t[5]=e=>A(Z).description=e),type:"textarea",rows:3},null,8,["modelValue"])])),_:1}),w(v,{label:"启用"},{default:V((()=>[w(g,{modelValue:A(Z).enabled,"onUpdate:modelValue":t[6]||(t[6]=e=>A(Z).enabled=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),w(ce,{modelValue:A(a),"onUpdate:modelValue":t[10]||(t[10]=e=>K(a)?a.value=e:null),title:"菜单权限",width:"520px","align-center":"",class:"el-dialog-border"},{footer:V((()=>[j("div",X,[w(i,{onClick:ne},{default:V((()=>[U(S(A(o)?"全部收起":"全部展开"),1)])),_:1}),w(i,{onClick:se,style:{"margin-left":"8px"}},{default:V((()=>[U(S(A(d)?"取消全选":"全部选择"),1)])),_:1}),w(i,{type:"primary",onClick:de},{default:V((()=>t[19]||(t[19]=[U("保存")]))),_:1,__:[19]})])])),default:V((()=>[w(pe,{height:"70vh"},{default:V((()=>[w(me,{ref_key:"treeRef",ref:r,data:A(c),"show-checkbox":"","node-key":"name","default-expand-all":A(o),"default-checked-keys":[1,2,3],props:re,onCheck:ue},{default:V((({data:e})=>[j("div",H,[e.isAuth?(C(),x("span",J,S(e.label),1)):(C(),x("span",W,S(re.label(e)),1))])])),_:1},8,["data","default-expand-all"])])),_:1})])),_:1},8,["modelValue"])])}}})))),[["__scopeId","data-v-b8082ba8"]]);export{Z as default};
