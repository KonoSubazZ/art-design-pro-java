import{u as e,_ as a,a as l,b as r,A as t}from"./useCheckedColumns-Czep2lLV.js";import{U as o,n as s,o as u,_ as n}from"./index-BHy-qhsq.js";/* empty css                */import{_ as d}from"./ArtTable-BVlC0wWp.js";/* empty css                    */import{R as i}from"./roleApi-BgB37-KE.js";import{S as p}from"./sysApi-BNJpJOJn.js";import{h as m,r as c,m as g,o as b,N as f,i as v,d as y,J as _,e as h,f as V,v as j,u as w,a9 as C,L as I,j as N,c as S,$ as k,a0 as P,_ as x,aa as U,a8 as z,Q as R,R as A,S as T,ab as q,ac as L,p as $,ad as B,ae as O}from"./vendor-CbDhNKi9.js";import"./formEnum-BLgiZVxV.js";import"./vue-draggable-plus-JPhlahyT.js";/* empty css               *//* empty css               *//* empty css                       *//* empty css                       *//* empty css                   *//* empty css                 */const E={class:"account-page",id:"table-full-screen"},F={class:"dialog-footer"},G=n(m({name:"User",__name:"index",setup(n){const m=c([]),G=c("add"),J=c(!1),Q=c(!1),W={name:"",phone:"",address:"",level:"",email:"",date:"",daterange:"",status:"1"},D=c([]),H=g({...W}),K=g({currentPage:1,pageSize:20,total:0}),M=c([]),X=c(),Y=c([]),Z=()=>{Object.assign(H,{...W}),K.currentPage=1,pe()},ee=()=>{K.currentPage=1,pe()},ae=e=>{},le=[{label:"用户名",prop:"name",type:"input",config:{clearable:!0},onChange:ae},{label:"电话",prop:"phone",type:"input",config:{clearable:!0},onChange:ae},{label:"用户等级",prop:"level",type:"select",config:{clearable:!0},options:()=>[{label:"普通用户",value:"normal"},{label:"VIP用户",value:"vip"},{label:"高级VIP",value:"svip"},{label:"企业用户",value:"enterprise",disabled:!0}],onChange:ae},{label:"地址",prop:"address",type:"input",config:{clearable:!0},onChange:ae},{label:"邮箱",prop:"email",type:"input",config:{clearable:!0},onChange:ae},{prop:"date",label:"日期",type:"date",config:{type:"date",placeholder:"请选择日期"}},{prop:"daterange",label:"日期范围",type:"daterange",config:{type:"daterange",startPlaceholder:"开始时间",endPlaceholder:"结束时间"}},{label:"状态",prop:"status",type:"radio",options:[{label:"在线",value:"1"},{label:"离线",value:"2"}],onChange:ae}],re=[{label:"勾选",type:"selection"},{label:"用户名",prop:"avatar"},{label:"手机号",prop:"mobile"},{label:"性别",prop:"gender"},{label:"角色",prop:"role"},{label:"状态",prop:"userStatus"},{label:"创建日期",prop:"createTime"},{label:"操作",prop:"operation"}],te=e=>{switch(e){case 1:return"success";case 2:default:return"info";case 3:return"warning";case 0:return"danger"}},oe=(e,a)=>{J.value=!0,G.value=e,ne.value&&ne.value.resetFields(),"edit"===e&&a?(de.value={...a},de.value.roleIds=Array.isArray(a.roleIds)?a.roleIds:[]):(de.value.userName="",de.value.mobile="",de.value.gender=0,de.value.roleIds=[])},{columnChecks:se,columns:ue}=e((()=>[{type:"selection"},{type:"index",label:"序号",width:80},{prop:"avatar",label:"用户名",minWidth:120,formatter:e=>$("div",{class:"user",style:"display: flex; align-items: center"},[e.avatar?$("img",{class:"avatar",src:e.avatar}):u(e.realName),$("div",{},[$("p",{class:"user-name"},`${e.realName} | ${e.userName}`),$("p",{class:"email"},e.email)])])},{label:"角色",prop:"roleIds",formatter:e=>$("div",{style:"display: flex; gap: 4px; flex-wrap: wrap"},e.roleIds.map((e=>{const a=D.value.find((a=>a.roleId===e));return $(B,{type:"primary",size:"small"},(()=>a?.roleName||"未知角色"))})))},{prop:"gender",label:"性别",sortable:!0,formatter:e=>{const a=m.value.find((a=>a.value===e.gender));return a?.label||"未知"}},{prop:"mobile",label:"手机号"},{prop:"userStatus",label:"状态",formatter:e=>$(B,{type:te(e.userStatus)},(()=>(e=>{let a="";return 0===e?a="禁用":1===e?a="启用":3===e?a="异常":4===e&&(a="注销"),a})(e.userStatus)))},{prop:"createTime",label:"创建日期",sortable:!0},{prop:"operation",label:"操作",width:150,formatter:e=>$("div",[$(t,{type:"edit",onClick:()=>oe("edit",e)}),$(t,{type:"delete",onClick:()=>{O.confirm("确定要注销该用户吗？","注销用户",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then((()=>{f.success("注销成功")}))}})])}])),ne=c(),de=c({userId:"",userName:"",realName:"",gender:1,email:"",mobile:"",avatar:"",intro:"",roleIds:[]});b((()=>{pe(),me(),ie()}));const ie=async()=>{const{success:e,data:a,msg:l}=await p.getOptions({name:"gender"});if(!e)return f.error(l);m.value=a.find((e=>"gender"===e.name))?.options||[]},pe=async()=>{Q.value=!0;try{const e={current:K.currentPage,size:K.pageSize},a=await o.getUserPageList(e);a.code===s.success&&(M.value=a.data.records,Q.value=!1,K.currentPage=a.data.current,K.pageSize=a.data.size,K.total=a.data.total)}catch(e){Q.value=!1}},me=async()=>{const e=await i.getRolePageList({});e.success?D.value=e.data.records:f.error(e.msg)},ce=()=>{pe()},ge=e=>{Y.value=e},be=g({userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],realName:[{required:!0,message:"请输入姓名",trigger:"blur"}],mobile:[{required:!1,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],roleIds:[{required:!0,message:"请选择角色",trigger:"change"}]}),fe=async()=>{if(ne.value)try{await ne.value.validate();const{success:e,msg:a}=await o.saveOrUpdate(de.value);if(!e)return f.error(a);f.success("add"===G.value?a:"更新成功"),J.value=!1,await pe()}catch(e){}},ve=e=>{K.pageSize=e,pe()},ye=e=>{K.currentPage=e,pe()};return(e,t)=>{const o=a,s=I,u=l,n=x,i=d,p=T,c=A,g=L,b=R,f=C,$=r;return y(),v($,null,{default:_((()=>[h("div",E,[V(o,{filter:w(H),"onUpdate:filter":t[0]||(t[0]=e=>j(H)?H.value=e:null),items:le,onReset:Z,onSearch:ee},null,8,["filter"]),V(f,{shadow:"never",class:"art-table-card"},{default:_((()=>[V(u,{columnList:re,columns:w(se),"onUpdate:columns":t[2]||(t[2]=e=>j(se)?se.value=e:null),onRefresh:ce},{left:_((()=>[V(s,{onClick:t[1]||(t[1]=e=>oe("add"))},{default:_((()=>t[12]||(t[12]=[N("新增用户")]))),_:1,__:[12]})])),_:1},8,["columns"]),V(i,{ref_key:"tableRef",ref:X,"row-key":"id",loading:w(Q),data:w(M),currentPage:w(K).currentPage,pageSize:w(K).pageSize,total:w(K).total,marginTop:10,onSelectionChange:ge,onSizeChange:ve,onCurrentChange:ye},{default:_((()=>[(y(!0),S(k,null,P(w(ue),(e=>(y(),v(n,U({key:e.prop||e.type},{ref_for:!0},e),null,16)))),128))])),_:1},8,["loading","data","currentPage","pageSize","total"]),V(w(z),{modelValue:w(J),"onUpdate:modelValue":t[11]||(t[11]=e=>j(J)?J.value=e:null),title:"add"===w(G)?"添加用户":"编辑用户",width:"30%","align-center":""},{footer:_((()=>[h("div",F,[V(s,{onClick:t[10]||(t[10]=e=>J.value=!1)},{default:_((()=>t[13]||(t[13]=[N("取消")]))),_:1,__:[13]}),V(s,{type:"primary",onClick:fe},{default:_((()=>t[14]||(t[14]=[N("提交")]))),_:1,__:[14]})])])),default:_((()=>[V(b,{ref_key:"formRef",ref:ne,model:w(de),rules:w(be),"label-width":"80px"},{default:_((()=>[V(c,{label:"用户名",prop:"userName"},{default:_((()=>[V(p,{readonly:"add"!==w(G),modelValue:w(de).userName,"onUpdate:modelValue":t[3]||(t[3]=e=>w(de).userName=e)},null,8,["readonly","modelValue"])])),_:1}),V(c,{label:"姓名",prop:"realName"},{default:_((()=>[V(p,{modelValue:w(de).realName,"onUpdate:modelValue":t[4]||(t[4]=e=>w(de).realName=e)},null,8,["modelValue"])])),_:1}),V(c,{label:"手机号",prop:"mobile"},{default:_((()=>[V(p,{modelValue:w(de).mobile,"onUpdate:modelValue":t[5]||(t[5]=e=>w(de).mobile=e)},null,8,["modelValue"])])),_:1}),V(c,{label:"邮箱",prop:"email"},{default:_((()=>[V(p,{modelValue:w(de).email,"onUpdate:modelValue":t[6]||(t[6]=e=>w(de).email=e)},null,8,["modelValue"])])),_:1}),V(c,{label:"性别",prop:"gender"},{default:_((()=>[V(w(q),{modelValue:w(de).gender,"onUpdate:modelValue":t[7]||(t[7]=e=>w(de).gender=e)},{default:_((()=>[(y(!0),S(k,null,P(w(m),(e=>(y(),v(g,{key:e.value,value:e.value,label:e.label},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(c,{label:"角色",prop:"role"},{default:_((()=>[V(w(q),{modelValue:w(de).roleIds,"onUpdate:modelValue":t[8]||(t[8]=e=>w(de).roleIds=e),multiple:""},{default:_((()=>[(y(!0),S(k,null,P(w(D),(e=>(y(),v(g,{key:e.roleId,value:e.roleId,label:e.roleName},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(c,{label:"简介",prop:"intro"},{default:_((()=>[V(p,{modelValue:w(de).intro,"onUpdate:modelValue":t[9]||(t[9]=e=>w(de).intro=e),rows:2,type:"textarea"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])),_:1})])])),_:1})}}}),[["__scopeId","data-v-e9618108"]]);export{G as default};
