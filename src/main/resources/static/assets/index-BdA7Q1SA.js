import{B as e,C as a,_ as l}from"./index-ud5QEMuE.js";/* empty css                    */import{_ as t}from"./ArtTable-F5e0hWfJ.js";/* empty css               *//* empty css               */import{R as o}from"./roleApi-C2MQXrzK.js";import{h as d,r,s,l as i,m as n,o as u,N as c,I as m,c as p,d as f,f as _,J as h,e as g,a1 as v,S as b,K as k,i as y,L as C,j as x,a2 as V,_ as w,ad as j,P as N,u as T,Q as L,R,aq as U,v as I,a8 as M,a5 as A,aH as K,ae as $}from"./vendor-CbDhNKi9.js";/* empty css                   *//* empty css                 */import"./formEnum-BLgiZVxV.js";const q={class:"page-content"},B={class:"dialog-footer"},S={style:{display:"flex","align-items":"center"}},E={key:0},P={key:1},z={class:"dialog-footer"},D=l(d({name:"Role",__name:"index",setup(l){const d=r(!1),D=r(!1),{menuList:F}=s(e()),G=r(),H=r(!0),J=r(!1),Q=i((()=>{const e=a=>{const l={...a};if(a.meta&&a.meta.authList&&a.meta.authList.length){const e=a.meta.authList.map((e=>({id:`${a.id}_${e.authMark}`,name:`${a.name}_${e.authMark}`,label:e.title,authMark:e.authMark,isAuth:!0,checked:e.checked||!1})));l.children=l.children?[...l.children,...e]:e}return l.children&&(l.children=l.children.map(e)),l};return F.value.map(e)})),O=r(),W=n({name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],des:[{required:!0,message:"请输入角色描述",trigger:"blur"}]}),X=n({roleId:"",roleName:"",roleCode:"",description:"",enabled:!0}),Y=r([]);u((()=>{Z()}));const Z=async()=>{const e=await o.getRolePageList({});e.success?Y.value=e.data.records:c.error(e.msg)},ee=r("add"),ae=(e,a)=>{d.value=!0,ee.value=e,"edit"===e&&a?(X.roleId=a.roleId,X.roleName=a.roleName,X.roleCode=a.roleCode,X.description=a.description,X.createTime=a.createTime,X.enabled=1===a.enabled):(X.roleName="",X.roleCode="",X.description="",X.createTime="",X.enabled=!0)},le={children:"children",label:e=>a(e.meta?.title)||""},te=()=>{c.success("权限保存成功"),D.value=!1},oe=()=>{const e=G.value;if(!e)return;const a=e.store.nodesMap;for(const l in a)a[l].expanded=!H.value;H.value=!H.value},de=()=>{const e=G.value;if(e){if(J.value)e.setCheckedKeys([]);else{const a=re(Q.value);e.setCheckedKeys(a)}J.value=!J.value}},re=e=>{const a=[],l=e=>{e.forEach((e=>{e.name&&a.push(e.name),e.children&&e.children.length>0&&l(e.children)}))};return l(e),a},se=()=>{const e=G.value;if(!e)return;const a=e.getCheckedKeys(),l=re(Q.value);J.value=a.length===l.length&&l.length>0};return(e,a)=>{const l=b,o=v,r=C,s=V,i=w,n=j,u=C,F=t,re=R,ie=U,ne=L,ue=M,ce=K,me=A,pe=m("ripple");return f(),p("div",q,[_(s,null,{default:h((()=>[_(o,{xs:24,sm:12,lg:6},{default:h((()=>[_(l,{placeholder:"角色名称"})])),_:1}),a[13]||(a[13]=g("div",{style:{width:"12px"}},null,-1)),_(o,{xs:24,sm:12,lg:6,class:"el-col2"},{default:h((()=>[k((f(),y(r,{onClick:Z},{default:h((()=>a[11]||(a[11]=[x("搜索")]))),_:1,__:[11]})),[[pe]]),k((f(),y(r,{onClick:a[0]||(a[0]=e=>ae("add"))},{default:h((()=>a[12]||(a[12]=[x("新增角色")]))),_:1,__:[12]})),[[pe]])])),_:1})])),_:1,__:[13]}),_(F,{data:T(Y),index:""},{default:h((()=>[_(i,{label:"角色名称",prop:"roleName"}),_(i,{label:"角色编码",prop:"roleCode"}),_(i,{label:"描述",prop:"description"}),_(i,{label:"启用",prop:"enable"},{default:h((e=>[_(n,{type:e.row.enabled?"primary":"info"},{default:h((()=>[x(N(e.row.enabled?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),_(i,{label:"创建时间",prop:"createTime"},{default:h((e=>{return[x(N((a=e.row.createTime,new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/\//g,"-"))),1)];var a})),_:1}),_(i,{fixed:"right",label:"操作",width:"200px"},{default:h((e=>[_(s,null,{default:h((()=>[_(u,{link:"",onClick:a[1]||(a[1]=e=>{D.value=!0})},{default:h((()=>a[14]||(a[14]=[x(" 菜单权限 ")]))),_:1,__:[14]}),_(u,{link:"",onClick:a=>ae("edit",e.row)},{default:h((()=>a[15]||(a[15]=[x(" 编辑 ")]))),_:2,__:[15]},1032,["onClick"]),_(u,{link:"",onClick:a[2]||(a[2]=e=>{$.confirm("确定删除该角色吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then((()=>{c.success("删除成功")}))})},{default:h((()=>a[16]||(a[16]=[x(" 删除 ")]))),_:1,__:[16]})])),_:2},1024)])),_:1})])),_:1},8,["data"]),_(ue,{modelValue:T(d),"onUpdate:modelValue":a[9]||(a[9]=e=>I(d)?d.value=e:null),title:"add"===T(ee)?"新增角色":"编辑角色",width:"30%","align-center":""},{footer:h((()=>[g("div",B,[_(r,{onClick:a[7]||(a[7]=e=>d.value=!1)},{default:h((()=>a[17]||(a[17]=[x("取消")]))),_:1,__:[17]}),_(r,{type:"primary",onClick:a[8]||(a[8]=e=>(async e=>{e&&await e.validate((a=>{if(a){const a="add"===ee.value?"新增成功":"修改成功";c.success(a),d.value=!1,e.resetFields()}}))})(T(O)))},{default:h((()=>a[18]||(a[18]=[x("提交")]))),_:1,__:[18]})])])),default:h((()=>[_(ne,{ref_key:"formRef",ref:O,model:T(X),rules:T(W),"label-width":"120px"},{default:h((()=>[_(re,{label:"角色名称",prop:"roleName"},{default:h((()=>[_(l,{modelValue:T(X).roleName,"onUpdate:modelValue":a[3]||(a[3]=e=>T(X).roleName=e)},null,8,["modelValue"])])),_:1}),_(re,{label:"角色编码",prop:"roleCode"},{default:h((()=>[_(l,{modelValue:T(X).roleCode,"onUpdate:modelValue":a[4]||(a[4]=e=>T(X).roleCode=e)},null,8,["modelValue"])])),_:1}),_(re,{label:"描述",prop:"roleStatus"},{default:h((()=>[_(l,{modelValue:T(X).description,"onUpdate:modelValue":a[5]||(a[5]=e=>T(X).description=e),type:"textarea",rows:3},null,8,["modelValue"])])),_:1}),_(re,{label:"启用"},{default:h((()=>[_(ie,{modelValue:T(X).enabled,"onUpdate:modelValue":a[6]||(a[6]=e=>T(X).enabled=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),_(ue,{modelValue:T(D),"onUpdate:modelValue":a[10]||(a[10]=e=>I(D)?D.value=e:null),title:"菜单权限",width:"520px","align-center":"",class:"el-dialog-border"},{footer:h((()=>[g("div",z,[_(r,{onClick:oe},{default:h((()=>[x(N(T(H)?"全部收起":"全部展开"),1)])),_:1}),_(r,{onClick:de,style:{"margin-left":"8px"}},{default:h((()=>[x(N(T(J)?"取消全选":"全部选择"),1)])),_:1}),_(r,{type:"primary",onClick:te},{default:h((()=>a[19]||(a[19]=[x("保存")]))),_:1,__:[19]})])])),default:h((()=>[_(me,{height:"70vh"},{default:h((()=>[_(ce,{ref_key:"treeRef",ref:G,data:T(Q),"show-checkbox":"","node-key":"name","default-expand-all":T(H),"default-checked-keys":[1,2,3],props:le,onCheck:se},{default:h((({data:e})=>[g("div",S,[e.isAuth?(f(),p("span",E,N(e.label),1)):(f(),p("span",P,N(le.label(e)),1))])])),_:1},8,["data","default-expand-all"])])),_:1})])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-b8082ba8"]]);export{D as default};
