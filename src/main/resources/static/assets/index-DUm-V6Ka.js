import{a,m as e,k as l,q as t,r as s,n as r,s as o,E as u,_ as i}from"./index-BHy-qhsq.js";/* empty css                  *//* empty css                    */import{_ as c}from"./ArtWangEditor.vue_vue_type_style_index_0_lang-B-jZ_ADj.js";/* empty css               *//* empty css               */import{h as d,Y as n,W as p,l as m,r as v,o as f,c as _,d as g,e as y,f as h,J as b,a1 as w,S as V,v as j,u as A,ab as $,$ as k,a0 as x,i as E,ac as q,a2 as T,R as Y,ao as M,ag as N,ap as U,aq as D,Q as P,j as W,P as z,L as B,N as I}from"./vendor-CbDhNKi9.js";import{P as L}from"./formEnum-BLgiZVxV.js";class C{static getArticleList(e){const{page:l,size:t,searchVal:s,year:r}=e;return a.get({url:`/api/articles/${l}/${t}?title=${s}&year=${r}`})}static getArticleTypes(e){return a.get({url:"/api/articles/types",params:e})}static getArticleDetail(e){return a.get({url:`/api/articles/${e}`})}static addArticle(e){return a.post({url:"/api/articles/",data:e})}static editArticle(e,l){return a.put({url:`/api/articles/${e}`,data:l})}}const J={class:"article-edit"},Q={class:"editor-wrap"},R={class:"form-wrap"},S={class:"el-top upload-container"},F={key:0,class:"upload-placeholder"},G=["src"],H={style:{display:"flex","justify-content":"flex-end"}},K=i(d({name:"ArticlePublish",__name:"index",setup(a){const i=n(),d=p(),K=e();let{saTokenInfo:O}=K;const X=m((()=>({[O.tokenName]:"Bearer "+O.tokenValue})));let Z=L.Add;const aa=v(""),ea=v(),la=v(),ta=v(""),sa=v(""),ra=v(""),oa=v(!0);f((()=>{l().scrollToTop(),da(),ua()}));const ua=()=>{const{id:a}=i.query;Z=a?L.Edit:L.Add,Z===L.Edit&&a?ia(Number(a)):ca()},ia=a=>{na=a,pa()},ca=()=>{sa.value=va(t().value)},da=async()=>{try{const a=await s.get("https://www.qiniu.lingchen.kim/classify.json");200===a.data.code&&(la.value=a.data.data)}catch(a){}};let na=0;const pa=async()=>{const a=await s.get("https://www.qiniu.lingchen.kim/blog_list.json");if(a.data.code===r.success){let{title:e,blog_class:l,html_content:t}=a.data.data;aa.value=e,ea.value=Number(l),ta.value=t}},ma=()=>{Z===L.Edit?ya():ga()},va=a=>o(a,"YYYY-MM-DD").value,fa=()=>aa.value?ea.value?"<p><br></p>"===ta.value?(I.error("请输入文章内容"),!1):!!ra.value||(I.error("请上传图片"),!1):(I.error("请选择文章类型"),!1):(I.error("请输入文章标题"),!1),_a=()=>({title:aa.value,html_content:ta.value,home_img:ra.value,blog_class:ea.value,create_time:sa.value}),ga=async()=>{try{if(!fa())return;ta.value=ha(ta.value);const a=_a();(await C.addArticle(a)).code===r.success&&(I.success(`发布成功 ${u[200]}`),Va())}catch(a){}},ya=async()=>{try{if(!fa())return;ta.value=ha(ta.value);const a=_a();(await C.editArticle(na,a)).code===r.success&&(I.success(`修改成功 ${u[200]}`),Va())}catch(a){}},ha=a=>a.replace(/(\s*)<\/code>/g,"</code>"),ba=a=>{ra.value=a.data.url,I.success(`图片上传成功 ${u[200]}`)},wa=()=>{I.error(`图片上传失败 ${u[500]}`)},Va=()=>{setTimeout((()=>{d.go(-1)}),800)},ja=a=>{const e=a.type.startsWith("image/"),l=a.size/1024/1024<2;return e?!!l||(I.error("图片大小不能超过 2MB!"),!1):(I.error("只能上传图片文件!"),!1)};return(a,e)=>{const l=V,t=w,s=q,r=$,o=T,u=c,i=N,d=M,n=Y,p=D,m=P,v=B;return g(),_("div",J,[y("div",null,[y("div",Q,[h(o,{gutter:10},{default:b((()=>[h(t,{span:18},{default:b((()=>[h(l,{modelValue:A(aa),"onUpdate:modelValue":e[0]||(e[0]=a=>j(aa)?aa.value=a:null),modelModifiers:{trim:!0},placeholder:"请输入文章标题（最多100个字符）",maxlength:"100"},null,8,["modelValue"])])),_:1}),h(t,{span:6},{default:b((()=>[h(r,{modelValue:A(ea),"onUpdate:modelValue":e[1]||(e[1]=a=>j(ea)?ea.value=a:null),placeholder:"请选择文章类型",filterable:""},{default:b((()=>[(g(!0),_(k,null,x(A(la),(a=>(g(),E(s,{key:a.id,label:a.name,value:a.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),h(u,{class:"el-top",modelValue:A(ta),"onUpdate:modelValue":e[2]||(e[2]=a=>j(ta)?ta.value=a:null)},null,8,["modelValue"]),y("div",R,[e[6]||(e[6]=y("h2",null,"发布设置",-1)),h(m,null,{default:b((()=>[h(n,{label:"封面"},{default:b((()=>[y("div",S,[h(d,{class:"cover-uploader",action:"/api/iboot/api/common/upload",headers:A(X),"show-file-list":!1,"on-success":ba,"on-error":wa,"before-upload":ja},{default:b((()=>[A(ra)?(g(),_("img",{key:1,src:A(ra),class:"cover-image"},null,8,G)):(g(),_("div",F,[h(i,{class:"upload-icon"},{default:b((()=>[h(A(U))])),_:1}),e[4]||(e[4]=y("div",{class:"upload-text"},"点击上传封面",-1))]))])),_:1},8,["headers"]),e[5]||(e[5]=y("div",{class:"el-upload__tip"},"建议尺寸 16:9，jpg/png 格式",-1))])])),_:1}),h(n,{label:"可见"},{default:b((()=>[h(p,{modelValue:A(oa),"onUpdate:modelValue":e[3]||(e[3]=a=>j(oa)?oa.value=a:null)},null,8,["modelValue"])])),_:1})])),_:1}),y("div",H,[h(v,{type:"primary",onClick:ma,style:{width:"100px"}},{default:b((()=>[W(z(A(Z)===A(L).Edit?"保存":"发布"),1)])),_:1})])])])])])}}}),[["__scopeId","data-v-f44c41a5"]]);export{K as default};
